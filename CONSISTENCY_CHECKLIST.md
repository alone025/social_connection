# Database Consistency & Performance Checklist

## ‚úÖ –ó–ê–î–ê–ß–ê 2.3 ‚Äî –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ Conference –∏ –¥–∞–Ω–Ω—ã—Ö

### Acceptance Criteria

#### ‚úÖ –í –ë–î –Ω–µ—Ç —Å–º–µ—à–µ–Ω–∏—è —Ç–∏–ø–æ–≤

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –°–æ–∑–¥–∞–Ω helper-–º–æ–¥—É–ª—å `src/lib/conference-helper.js` –¥–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ `conferenceCode` ‚Üí `conferenceId` (ObjectId)
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `getConferenceIdByCode()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ObjectId –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∫ –ë–î
- ‚úÖ `conferenceCode` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è UX (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, URL, QR-–∫–æ–¥—ã)
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç `conferenceId` (ObjectId) –¥–ª—è —Å—Å—ã–ª–æ–∫ –Ω–∞ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏—é

**–û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/lib/conference-helper.js` ‚Äî –Ω–æ–≤—ã–π helper-–º–æ–¥—É–ª—å
- `src/services/question.service.js` ‚Äî –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `conferenceId` (ObjectId)
- `src/services/poll.service.js` ‚Äî –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `conferenceId` (ObjectId)
- `src/services/matching.service.js` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `conferenceId` (ObjectId)
- `src/second-screen/routes.js` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `conferenceId` (ObjectId) –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- `src/second-screen/socket.js` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `conferenceId` (ObjectId)

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü–æ–∏—Å–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è conferenceCode –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö –∫ –ë–î (–Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å)
grep -r "Conference.findOne({ conferenceCode" src/services/
grep -r "conference: conferenceCode" src/
```

#### ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –µ–¥–∏–Ω—ã–π —Ç–∏–ø conferenceId

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –í—Å–µ –º–æ–¥–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `conference: { type: Schema.Types.ObjectId, ref: 'Conference' }`
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç ObjectId –¥–ª—è –ø–æ–ª—è `conference`
- ‚úÖ Helper-—Ñ—É–Ω–∫—Ü–∏—è `getConferenceIdByCode()` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—É—é –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—é
- ‚úÖ `conferenceCode` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è:
  - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–æ–¥–∞)
  - URL –≤—Ç–æ—Ä–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ (`/second-screen/:code`)
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–æ–∫ –≤ –±–æ—Ç–µ
  - QR-–∫–æ–¥–æ–≤

**–¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö:**
- `conferenceCode` (String) ‚Äî —Ç–æ–ª—å–∫–æ –¥–ª—è UX
- `conferenceId` / `conference._id` (ObjectId) ‚Äî –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π —Å –ë–î

---

## ‚úÖ –ó–ê–î–ê–ß–ê 2.4 ‚Äî –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –∏–Ω–¥–µ–∫—Å—ã DB

### Acceptance Criteria

#### ‚úÖ –ù–µ—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤:**

1. **Conference Model:**
   ```javascript
   conferenceSchema.index({ isEnded: 1, isActive: 1 }); // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π
   conferenceSchema.index({ startsAt: 1 }); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ –Ω–∞—á–∞–ª–∞
   conferenceSchema.index({ admins: 1 }); // –ü–æ–∏—Å–∫ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π –ø–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
   // conferenceCode —É–∂–µ –∏–º–µ–µ—Ç unique index
   ```

2. **UserProfile Model:**
   ```javascript
   userProfileSchema.index({ conference: 1, isActive: 1 }); // –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
   userProfileSchema.index({ telegramId: 1 }); // –ü–æ–∏—Å–∫ –ø–æ Telegram ID
   userProfileSchema.index({ conference: 1, telegramId: 1 }); // –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–∏
   userProfileSchema.index({ conference: 1, 'roles': 1 }); // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ä–æ–ª—è–º
   userProfileSchema.index({ conference: 1, onboardingCompleted: 1 }); // –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø—Ä–æ—Ñ–∏–ª–∏
   ```

3. **Question Model:**
   ```javascript
   questionSchema.index({ conference: 1, status: 1 }); // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Å—Ç–∞—Ç—É—Å—É
   questionSchema.index({ conference: 1, isAnswered: 1 }); // –ù–µ–æ—Ç–≤–µ—á–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
   questionSchema.index({ conference: 1, status: 1, createdAt: 1 }); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–Ω—ã—Ö
   questionSchema.index({ targetSpeaker: 1, status: 1 }); // –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–ø–∏–∫–µ—Ä–∞
   questionSchema.index({ author: 1 }); // –í–æ–ø—Ä–æ—Å—ã –ø–æ –∞–≤—Ç–æ—Ä—É
   ```

4. **Poll Model:**
   ```javascript
   pollSchema.index({ conference: 1, isActive: 1 }); // –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–ø—Ä–æ—Å—ã
   pollSchema.index({ conference: 1, createdAt: -1 }); // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–µ —Å–æ–∑–¥–∞–Ω–∏—è
   ```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:**
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—è
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –ø–æ –¥–∞—Ç–∞–º

#### ‚úÖ –ú–∞—Ç—á–∏–Ω–≥ –∏ —ç–∫—Ä–∞–Ω —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –º–∞—Ç—á–∏–Ω–≥–∞:**
- ‚úÖ `searchProfiles()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
  - `conference: conferenceId` ‚Äî –∏–Ω–¥–µ–∫—Å
  - `isActive: true` ‚Äî —á–∞—Å—Ç—å —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞
  - `onboardingCompleted: true` ‚Äî –∏–Ω–¥–µ–∫—Å
  - `roles: role` ‚Äî –∏–Ω–¥–µ–∫—Å –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–æ–ª—è–º

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤—Ç–æ—Ä–æ–≥–æ —ç–∫—Ä–∞–Ω–∞:**
- ‚úÖ REST API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `conferenceId` (ObjectId) –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ Socket.IO –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `conferenceId` –¥–ª—è –∫–æ–º–Ω–∞—Ç
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã:
  - `Poll.find({ conference: conferenceId, isActive: true })` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å
  - `Question.find({ conference: conferenceId, status: 'approved' })` ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ –í—Å–µ —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –ø–æ–∫—Ä—ã–≤–∞—é—Ç —á–∞—Å—Ç—ã–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å 500-2000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

---

## üìã –ò—Ç–æ–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Ç–∏–ø–æ–≤
- ‚úÖ –ù–µ—Ç —Å–º–µ—à–µ–Ω–∏—è `conferenceCode` (String) –∏ `conferenceId` (ObjectId) –≤ –ë–î
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç ObjectId
- ‚úÖ `conferenceCode` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è UX

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤–æ –≤—Å–µ –º–æ–¥–µ–ª–∏
- ‚úÖ –ó–∞–ø—Ä–æ—Å—ã –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∫–æ–º–±–∏–Ω–∞—Ü–∏–π

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
–î–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ MongoDB
db.userprofiles.getIndexes()
db.questions.getIndexes()
db.polls.getIndexes()
db.conferences.getIndexes()

# –ê–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
db.userprofiles.find({ conference: ObjectId("..."), isActive: true }).explain("executionStats")
```

---

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í—Å–µ –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø—Ä–∏–µ–º–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã
